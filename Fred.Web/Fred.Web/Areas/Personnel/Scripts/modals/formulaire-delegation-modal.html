<!--BEGIN :  Modal Ajout d'une -->

<div class="modal-content">
    <div class="modal-header">
        <h2 class="modal-title" ng-show="$ctrl.delegationModal.DelegationId > 0"><i class="flaticon-users"></i> {{$ctrl.resources.Personnel_ModalDelegation_Titre_Modification}}</h2>
        <h2 class="modal-title" ng-show="$ctrl.delegationModal.DelegationId == 0"><i class="flaticon-users"></i> {{$ctrl.resources.Personnel_ModalDelegation_Titre_Creation}}</h2>
        <i class="flaticon flaticon-multiply close pull-right" ng-click="$ctrl.handleCancel()" title="{{$ctrl.resources.Global_Modal_Annuler_Tooltip}}"></i>
    </div>
    <form name="$ctrl.delegationForm">
        <div class="modal-body">
            <div class="row">
                <!--Utilisateur Delegue-->
                <div class="row">
                    <div class="col-md-12" ng-class="{'has-error': $ctrl.delegationForm.$submitted && $ctrl.delegationForm.PersonnelDelegue.$invalid}">
                        <label>
                            {{$ctrl.resources.Personnel_ModalDelegation_PersonnelDelegue}}
                        </label><br />
                        <span class="text-danger" ng-show="$ctrl.delegationForm.$submitted && $ctrl.delegationForm.Delegue.$error.required">{{$ctrl.resources.Global_Control_DataRequired_Erreur}}</span>
                        <div>
                            <feature-flag invert feature-key="PersonnelsNouveauxFiltres">
                                <lookup-standalone ng-model="$ctrl.delegationModal.PersonnelDelegue"
                                                   text="$ctrl.delegationModal.PersonnelDelegue.PrenomNom"
                                                   search-title="{{$ctrl.resources.Global_ReferentielPersonnel}}"
                                                   search-placeholder="{{$ctrl.resources.Global_ReferentielPersonnel_Placeholder}}"
                                                   on-select="$ctrl.handleSelectedItem(item)"
                                                   on-delete="$ctrl.handleDelete()"
                                                   ng-required="true"
                                                   name="Delegue"
                                                   show-in-popup="true"
                                                   class="formulaire long no-padding"
                                                   style-parent="true"
                                                   url="/api/Delegation/Delegue/{{$ctrl.delegationModal.PersonnelDelegantId}}/?societeId={{$ctrl.societeId}}&"
                                                   custom-template-url="/Scripts/directive/Lookup/custom-templates/delegue.template.html">
                                </lookup-standalone>
                            </feature-flag>
                            <feature-flag feature-key="PersonnelsNouveauxFiltres">
                                <lookup-standalone ng-model="$ctrl.delegationModal.PersonnelDelegue"
                                                   text="$ctrl.delegationModal.PersonnelDelegue.PrenomNom"
                                                   search-title="{{$ctrl.resources.Global_ReferentielPersonnel}}"
                                                   search-placeholder="{{$ctrl.resources.Personnel_PartialGeneral_Nom_Placeholder}}"
                                                   search-placeholder2="{{$ctrl.resources.Personnel_PartialGeneral_Prenom_Placeholder}}"
                                                   search-placeholder3="{{$ctrl.resources.Personnel_Filter_Autre_Information_Placeholder}}"
                                                   active-second-search-input="true"
                                                   active-third-search-input="true"
                                                   on-select="$ctrl.handleSelectedItem(item)"
                                                   on-delete="$ctrl.handleDelete()"
                                                   ng-required="true"
                                                   name="Delegue"
                                                   show-in-popup="true"
                                                   class="formulaire long no-padding"
                                                   style-parent="true"
                                                   url="/api/Delegation/SplitDelegue/{{$ctrl.delegationModal.PersonnelDelegantId}}/?societeId={{$ctrl.societeId}}&"
                                                   custom-template-url="/Scripts/directive/Lookup/custom-templates/delegue.template.html">
                                </lookup-standalone>
                            </feature-flag>
                        </div>
                    </div>
                </div>
                <!--DATE ENREE ET DATE SORTIE-->
                <div class="row">
                    <div class="col-md-6" ng-class="{'has-error': $ctrl.delegationForm.$submitted && $ctrl.delegationForm.DateDeDebut.$invalid}">
                        <label>{{$ctrl.resources.Personnel_ModalDelegation_DateDeDebut}}</label>
                        <span class="text-danger" ng-show="$ctrl.delegationForm.$submitted && $ctrl.delegationForm.DateDeDebut.$error.required">{{$ctrl.resources.Global_Control_DataRequired_Erreur}}</span>
                        <span class="text-danger" ng-show="$ctrl.delegationForm.$submitted && $ctrl.delegationForm.DateDeDebut.$error.RangeError">{{$ctrl.resources.Personnel_ModalDesaffectation_VerificationDateEntree_Erreur}}</span>
                        <div>
                            <app-date-picker id="DateDeDebut"
                                             name="DateDeDebut"
                                             format="DD/MM/YYYY"
                                             lang="fr"
                                             placeholder="{{$ctrl.resources.Personnel_ModalDelegation_DateDeDebut}}"
                                             initial-date="{{$ctrl.delegationModal.DateDeDebut}}"
                                             ng-model="$ctrl.delegationModal.DateDeDebut"
                                             ng-change="$ctrl.handleDateValidation()"
                                             ng-required="true" />
                        </div>
                    </div>

                    <div class="col-md-6" ng-class="{'has-error': $ctrl.delegationForm.$submitted && $ctrl.delegationForm.DateDeFin.$invalid}">
                        <label>{{$ctrl.resources.Personnel_ModalDelegation_DateDeFin}}</label>
                        <span class="text-danger" ng-show="$ctrl.delegationForm.$submitted && $ctrl.delegationForm.DateDeFin.$error.required">{{$ctrl.resources.Global_Control_DataRequired_Erreur}}</span>
                        <div>
                            <app-date-picker id="DateDeFin"
                                             name="DateDeFin"
                                             format="DD/MM/YYYY"
                                             lang="fr"
                                             placeholder="{{$ctrl.resources.Personnel_ModalDelegation_DateDeFin}}"
                                             initial-date="{{$ctrl.delegationModal.DateDeFin}}"
                                             ng-model="$ctrl.delegationModal.DateDeFin"
                                             ng-change="$ctrl.handleDateValidation()"
                                             ng-required="true" />
                        </div>
                    </div>


                </div>
            </div>

            <!--Utilisateur Delegue-->
            <div class="row">
                <div class="col-md-12">
                    <label>
                        {{$ctrl.resources.Personnel_ModalDelegation_Commentaire}}
                    </label><br />

                    <div>
                        <textarea class="form-control"
                                  id="Commentaire"
                                  rows="5"
                                  col="50"
                                  ng-model="$ctrl.delegationModal.Commentaire">
            </textarea>
                    </div>
                </div>
            </div>

            <div class="row" ng-show="$ctrl.errorValidation">
                <div class="col-md-12">
                    <span class="text-danger">{{$ctrl.resources.Personnel_ModalDelegation_Notify_Error_Validation}}</span>
                </div>
            </div>
        </div>



        <!--FOOTER - BOUTONS VALIDER ET ANNULER-->
        <div class="modal-footer">
            <button type="submit" class="btn btn-default pull-left"
                    ng-click="$ctrl.handleSave()" ng-disabled="$ctrl.delegationForm.$submitted && $ctrl.delegationForm.$invalid"
                    title="{{$ctrl.resources.Global_Bouton_Valider_Tooltip}}">
                {{$ctrl.resources.Global_Bouton_Valider}}
            </button>
            <button type="button" class="btn btn-link pull-right"
                    ng-click="$ctrl.handleCancel()"
                    title="{{$ctrl.resources.Global_Bouton_Annuler_Tooltip}}">
                {{$ctrl.resources.Global_Bouton_Annuler}}
            </button>
        </div>
    </form>
</div>
<!--END :  Modal Ajout d'une ligne -->