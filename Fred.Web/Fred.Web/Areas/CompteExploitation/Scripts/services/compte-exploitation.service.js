(function () {
    'use strict';

    angular.module('Fred').service('CompteExploitationService', CompteExploitationService);

    CompteExploitationService.$inject = ['$http', '$filter', '$q', '$window'];

    function CompteExploitationService($http, $filter, $q, $window) {
        var uriBase = "/api/CompteExploitation/";

        this.edition = function (params) {

            return $http.post(uriBase + "Edition" + params.TypeEdition + "/"
                + params.Format + "/"
                + params.CI + "/"
                + $filter('date')(params.Period, 'yyyy-MM')
                + "/" + params.Perimeter
                + "/" + params.AnalyticAxis
                + "/" + params.PrincipalAxis
                + "?&valFiltre=" + params.Filtre
                + "&valFiltreLibelle=" + params.FiltreLibelle);
        };

        this.pointingVerif = function (params) {
            return $http.post(uriBase + "EtatVerifPointing", params, { cache: false });
        };

        this.CreateBilanTechniqueExportExcel = function (model) {
            return $http.post(uriBase + "BilanExport", model);
        };


        this.DownloadBilanTechniqueExport = function (id, isPdf) {
            $window.location.href = uriBase + "BilanExport/" + id + "/" + isPdf;
        };

        // Export du tableau de synthese
        this.TableauSyntheseExport = function (model) {
            return $q(function (resolve, reject) {
                return $http.post(uriBase + "TableauSyntheseExport", model)
                    .success(function (data) {
                        window.location.href = uriBase + 'ExtractDocument/' + data.id + '/' + 'TableauSynthese' + '/' + model.isPdfConverted;
                        resolve(data);
                    })
                    .error(function (data) { reject(data); });
            });
        };

        //  Download de l'Export du tableau de synthese
        this.TableauSyntheseExportDownload = function (guidIdExport, fileName) {
            window.location.href = uriBase + '/TableauSyntheseExportDownload/' + guidIdExport + '/' + fileName;
        };
    }
})();