@using Fred.Web.Shared.App_LocalResources

@{
    /**/

    Layout = "~/Views/Shared/_Layout.new.cshtml";
    ViewBag.Title = "Edition d'Exploitation";
}

@section styles {
    @Styles.Render("~/CompteExploitationBundleFactory.css")
    @Styles.Render("~/Areas/CompteExploitation/Content/Style.css")
}

@section scripts {
    @Scripts.Render("~/CompteExploitationBundleFactory.js")
    @Scripts.Render("~/LookupIndexBundle.js")
    @this.RenderResources("FeatureCompteExploitation")


}
<script></script>

<div class="container edition-compte-exploitation" ng-controller="CompteExploitationController as $ctrl" ng-init="init('@ViewBag.favoriId')">

    <!-- START : Titre de la page -->
    <h1>{{$ctrl.resources.CE_PageTitle}}</h1>

    <!-- END : Titre de la page -->
    <!--START : Barre de recherche + Barre d'outils-->
    <fred-toolbar>

        <!--Période-->
        <fred-section class="date-section">
            <fred-section-title>{{$ctrl.resources.CE_Period}}</fred-section-title>
            <fred-section-controls>
                <div class="input-group date">
                    <app-date-picker format="MM/YYYY" lang="fr"
                                     ng-model="$ctrl.Period"
                                     placeholder=""
                                     ng-change="$ctrl.changeDate()"
                                     max-date="{{$ctrl.maxDate}}" />
                </div>
            </fred-section-controls>
        </fred-section>

        <!--Sélection CI-->
        <fred-section class="picklist-section">
            <fred-section-title>{{$ctrl.resources.CE_CI}}</fred-section-title>

            <fred-section-controls>
                <div class="inner-addon right-addon">
                    <lookup-standalone class="searchbar formulaire"
                                       ng-model="$ctrl.ciSelected"
                                       text="$ctrl.ciSelected.CodeLibelle"
                                       search-placeholder="{{$ctrl.resources.Global_ReferentielCI_Placeholder}}"
                                       custom-template-url="~/Scripts/directive/lookup/custom-templates/ci.template.html"
                                       search-title="{{$ctrl.resources.Global_ReferentielCI}}"
                                       on-select="$ctrl.handleLigneLookupSelection('CI', item, $ctrl.ciSelected)"
                                       show-delete-button="false"
                                       url="/api/CI/SearchLight">
                    </lookup-standalone>
                </div>
                <fred-button class="fred-button white-star col-sm-4" type="button" ng-click="$ctrl.handleAddFilter2Favoris()" title="{{ctrl.resources.Button_Save_Favorite_Title}}">
                    <i class="material-icons">star</i>
                </fred-button>
            </fred-section-controls>
        </fred-section>



    </fred-toolbar>
    <!--END : Barre de recherche + Barre d'outils-->
    <!--Start : Message à caractère informatif-->
    <div ng-show="$ctrl.blocInformation" class="row information">
        <div class="col-md-4 icon">
            <span class="flaticon flaticon-warning"></span>
        </div>
        <div class="col-md-4 msg">
            <h3>
                {{$ctrl.resources.CE_SelectCI}}
            </h3>
        </div>
    </div>
    <!--End : Message à caractère informatif-->
    <!--Start : tuiles -->
    <div ng-show="$ctrl.blocDepensesExploitation" class="bloc-depenses-exploitation">

        <div class="detail-depenses-exploitation" data-toggle="modal" data-target="#ed-dep-ex" title="Cliquer pour" ng-click="$ctrl.btnOpenPopup('13C')">
            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Depenses13}}</span>
        </div>
        <div class="detail-depenses-exploitation" data-toggle="modal" data-target="#ed-dep-ex" title="Cliquer pour" ng-click="$ctrl.btnOpenPopup('4C')">
            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Depenses4}}</span>
        </div>
        <div class="detail-VerifPointage-exploitation" data-toggle="modal" data-target="#ed-pointage-ex" title="Cliquer pour" ng-click="$ctrl.btnOpenPopup('Pt')">
            <span class="detail-VerifPointage-exploitation-txt">{{$ctrl.resources.CE_EditionVerif_Pointage}}</span>
        </div>
        <div class="detail-depenses-exploitation" data-toggle="modal" data-target="#ed-bil-tech" title="Cliquer pour" ng-click="$ctrl.btnOpenPopup('BilanTechnique')">
            <span class="detail-depenses-exploitation-txt">Bilan Technique</span>
        </div>
        <div class="detail-depenses-exploitation" data-toggle="modal" data-target="#ed-synthese" title="Cliquer pour editer le tableau de synthese" ng-click="$ctrl.btnOpenPopup('TableauSynthese')">
            <span class="detail-depenses-exploitation-txt">Tableau de synthèse</span>
        </div>

    </div>
    <!--End : tuiles -->
    <!-- Modal pop Dépenses in de rapprochement -->
    <div class="modal fade" id="ed-dep-ex" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-show="$ctrl.popVisible.popDepenses">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="flaticon flaticon-shuffle-1"></i>{{$ctrl.popupTitle}}</h2>
                    <i class="flaticon flaticon-multiply close pull-right" data-dismiss="modal" aria-label="Close"
                       title="Cliquer pour annuler et fermer" ng-click="$ctrl.cancelEdition()"></i>
                </div>
                <div class="modal-body">
                    <div class="bloc-stepper">
                        <div class="stepper-line">
                            <div id="stepper1" class="stepper-step selected">1</div>
                            <div id="stepper2" class="stepper-step">2</div>
                            <div id="stepper3" class="stepper-step">3</div>
                        </div>
                        <div class="stepper-bloc-text">
                            <div class="stepper-text">{{$ctrl.resources.CE_Popup_Step1}}</div>
                            <div class="stepper-text central">{{$ctrl.resources.CE_Popup_Step2}}</div>
                            <div class="stepper-text">{{$ctrl.resources.CE_Popup_Step3}}</div>
                        </div>
                    </div>

                    <div class="bloc-axes-res-tasks">
                        <div class="axes-res-tasks-btns">
                            <button id="btnTasksRes" class="tasks-res selected" ng-model="$ctrl.buttonTacheRessource"
                                    ng-show="$ctrl.buttonsSecondFilterVisible"
                                    ng-click="$ctrl.btnAxeGroupClick('TacheRessource')">
                                {{$ctrl.resources.CE_Popup_Button_TacheRessource}}
                            </button>
                            <button id="btnResTasks" class="res-tasks " ng-model="$ctrl.buttonRessourceTache"
                                    ng-show="$ctrl.buttonsSecondFilterVisible"
                                    ng-click="$ctrl.btnAxeGroupClick('RessourceTache')">
                                {{$ctrl.resources.CE_Popup_Button_RessourceTache}}
                            </button>
                        </div>
                        <div class="axes-res-tasks-txt" id="secondLevelFilterTitle">{{$ctrl.resources.CE_Popup_PleaseSelectAxis}}</div>
                    </div>

                    @* FIRST LEVEL FILTER *@
                    <div class="bloc-ed-dep-tiles">
                        <div class="detail-depenses-exploitation" id="firstLevelFilterComplet"
                             ng-click="$ctrl.firstLevelFilterClick($event, 'Complet', true)">
                            <span class="detail-depenses-exploitation-txt">              {{$ctrl.resources.CE_Popup_Filtre_CptExploitation}}            </span>
                            <div class="inner-triangle" ng-show="$ctrl.firstLevelFilterTriangle"></div>
                        </div>
                        @* OU *@
                        <span class="or" ng-show="$ctrl.firstLevelFilter">{{$ctrl.resources.CE_Popup_Ou}}</span>
                        <div class="detail-depenses-exploitation" id="firstLevelFilterChapitre"
                             ng-click="$ctrl.firstLevelFilterClick($event, 'Chapitre')">
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre_Chap}}</span>
                            <div class="inner-triangle" ng-show="$ctrl.firstLevelFilterTriangle"></div>
                            <div class="triangle-down-arrow" ng-show="$ctrl.firstLevelFilterTriangle"> </div>
                        </div>
                        @* OU *@
                        <span class="or" ng-show="$ctrl.firstLevelFilter">{{$ctrl.resources.CE_Popup_Ou}}</span>
                        <div class="detail-depenses-exploitation" id="firstLevelFilterSousChapitre"
                             ng-click="$ctrl.firstLevelFilterClick($event, 'SousChapitre')">
                            <div class="inner-triangle" ng-show="$ctrl.firstLevelFilterTriangle"></div>
                            <div class="triangle-down-arrow" ng-show="$ctrl.firstLevelFilterTriangle">           </div>
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre_SousChap}}</span>
                        </div>
                        @* OU *@
                        <span class="or" ng-show="$ctrl.firstLevelFilter">{{$ctrl.resources.CE_Popup_Ou}}</span>
                        <div class="detail-depenses-exploitation" id="firstLevelFilterT1"
                             ng-click="$ctrl.firstLevelFilterClick($event, 'T1')">
                            <div class="inner-triangle" ng-show="$ctrl.firstLevelFilterTriangle"></div>
                            <div class="triangle-down-arrow" ng-show="$ctrl.firstLevelFilterTriangle">           </div>
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre_T1}}</span>
                        </div>
                        @* OU *@
                        <span class="or" ng-show="$ctrl.firstLevelFilter">{{$ctrl.resources.CE_Popup_Ou}}</span>
                        <div class="detail-depenses-exploitation" id="firstLevelFilterT2"
                             ng-click="$ctrl.firstLevelFilterClick($event, 'T2')">
                            <div class="inner-triangle" ng-show="$ctrl.firstLevelFilterTriangle"></div>
                            <div class="triangle-down-arrow" ng-show="$ctrl.firstLevelFilterTriangle">           </div>
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre_T2}}</span>
                        </div>
                        @* ------------------- *@
                        @* SECOND LEVEL FILTER *@
                        @* ------------------- *@
                        <div class="row">
                            <div id="secondLevelGroupT" style="display:flex" class="col-md-6 no-padding" ng-class="{'pull-right':$ctrl.alignRightsecondLevelGroupT}">
                                <div class="detail-depenses-exploitation" id="secondLevelFilterT1"
                                     ng-click="$ctrl.secondLevelFilterClick($event, 'T1')">
                                    <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre2_T1}}</span>
                                    <div class="inner-triangle" ng-show="$ctrl.secondLevelFilterTriangle"></div>
                                </div>
                                <div class="detail-depenses-exploitation" id="secondLevelFilterT2"
                                     ng-click="$ctrl.secondLevelFilterClick($event, 'T2')">
                                    <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre2_T2}}</span>
                                    <div class="inner-triangle" ng-show="$ctrl.secondLevelFilterTriangle"></div>
                                </div>
                                <div class="detail-depenses-exploitation" id="secondLevelFilterT3"
                                     ng-click="$ctrl.secondLevelFilterClick($event, 'T3')">
                                    <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre2_T3}}</span>
                                    <div class="inner-triangle" ng-show="$ctrl.secondLevelFilterTriangle"></div>
                                </div>
                            </div>
                            <div id="secondLevelGroupChapitre" style="display:flex" class="col-md-6 no-padding">
                                <div class="detail-depenses-exploitation" id="secondLevelFilterChapitre"
                                     ng-click="$ctrl.secondLevelFilterClick($event, 'Chapitre')">
                                    <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre2_Chap}}</span>
                                    <div class="inner-triangle" ng-show="$ctrl.secondLevelFilterTriangle"></div>
                                </div>
                                <div class="detail-depenses-exploitation" id="secondLevelFilterSousChapitre"
                                     ng-click="$ctrl.secondLevelFilterClick($event, 'SousChapitre')">
                                    <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre2_SousChap}}</span>
                                    <div class="inner-triangle" ng-show="$ctrl.secondLevelFilterTriangle"></div>
                                </div>
                                <div class="detail-depenses-exploitation" id="secondLevelFilterRessource"
                                     ng-click="$ctrl.secondLevelFilterClick($event, 'Ressource')">
                                    <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre2_Ress}}</span>
                                    <div class="inner-triangle" ng-show="$ctrl.secondLevelFilterTriangle"></div>
                                </div>
                            </div>
                        </div>
                        @* ------------------- *@
                        @*BOUTONS FORMATS PDF / EXCEL*@
                        @* ------------------- *@
                        <div class="detail-depenses-exploitation" id="formatExportPDF"
                             ng-show="$ctrl.FormatVisible" ng-click="$ctrl.formatClick($event, 'PDF')">
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_FormatPDF}}</span>
                            <div class="inner-triangle"></div>
                            <span class="detail-depenses-icon pdf"></span>
                        </div>
                        <div class="detail-depenses-exploitation" id="formatExportExcel"
                             ng-show="$ctrl.FormatVisible" ng-click="$ctrl.formatClick($event, 'Excel')">
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_FormatExcel}}</span>
                            <div class="inner-triangle"></div>
                            <span class="detail-depenses-icon excel"></span>
                        </div>

                    </div>


                    @*REGROUPEMENT Taches T1 Veuillez sélectionner une valeur de filtre*@
                    <div class="modal-toolbar" id="firstLevelPartialStateFilterT1">
                        <div class="modal-toolbar-bloc">
                            <fred-section-title>{{$ctrl.resources.CE_Popup_FiltreSelect}}</fred-section-title>
                            <div class="inner-addon right-addon">
                                <lookup-standalone class="searchbar"
                                                   ng-model="$ctrl.tacheSelected"
                                                   text="$ctrl.tacheSelected.Libelle"
                                                   search-placeholder="{{$ctrl.resources.Global_ReferentielTache_Placeholder}}"
                                                   search-title="{{$ctrl.resources.Global_ReferentielT1}}"
                                                   on-select="$ctrl.handleLigneLookupSelection('Tache', item, $ctrl.tacheSelected)"
                                                   show-in-popup="true"
                                                   show-delete-button="false"
                                                   url="/api/CompteExploitation/GetTaches/{{$ctrl.ciSelected.CiId}}/1">
                                </lookup-standalone>
                            </div>
                        </div>
                    </div>

                    @*REGROUPEMENT Taches T2 / Veuillez sélectionner une valeur de filtre*@
                    <div class="modal-toolbar" id="firstLevelPartialStateFilterT2">
                        <div class="modal-toolbar-bloc">
                            <fred-section-title>{{$ctrl.resources.CE_Popup_FiltreSelect}}</fred-section-title>
                            <div class="inner-addon right-addon">
                                <lookup-standalone class="searchbar"
                                                   ng-model="$ctrl.tacheSelected"
                                                   text="$ctrl.tacheSelected.Libelle"
                                                   search-placeholder="{{$ctrl.resources.Global_ReferentielTache_Placeholder}}"
                                                   search-title="{{$ctrl.resources.Global_ReferentielT2}}"
                                                   on-select="$ctrl.handleLigneLookupSelection('Tache', item, $ctrl.tacheSelected)"
                                                   show-in-popup="true"
                                                   show-delete-button="false"
                                                   url="/api/CompteExploitation/GetTaches/{{$ctrl.ciSelected.CiId}}/2">
                                </lookup-standalone>
                            </div>
                        </div>
                    </div>

                    @*CHAPITRE / Veuillez sélectionner une valeur de filtre*@
                    <div class="modal-toolbar" id="firstLevelPartialStateFilterChapitre">

                        <div class="modal-toolbar-bloc">
                            <fred-section-title>{{$ctrl.resources.CE_Popup_FiltreSelect}}</fred-section-title>
                            <div class="inner-addon right-addon">
                                <lookup-standalone class="searchbar"
                                                   ng-model="$ctrl.chapSelected"
                                                   text="$ctrl.chapSelected.CodeLibelle"
                                                   search-placeholder="{{$ctrl.resources.Global_ReferentielTache_Placeholder}}"
                                                   search-title="{{$ctrl.resources.Global_ReferentielChapitre}}"
                                                   on-select="$ctrl.handleLigneLookupSelection('Chapitre', item, $ctrl.userGroup)"
                                                   show-in-popup="true"
                                                   show-delete-button="false"
                                                   url="/api/CompteExploitation/GetChapitres/{{$ctrl.userGroup}}">
                                </lookup-standalone>
                            </div>

                        </div>
                    </div>

                    @*SOUSCHAPITRE / Veuillez sélectionner une valeur de filtre*@
                    <div class="modal-toolbar" id="firstLevelPartialStateFilterSousChapitre">

                        <div class="modal-toolbar-bloc">
                            <fred-section-title>{{$ctrl.resources.CE_Popup_FiltreSelect}}</fred-section-title>
                            <div class="inner-addon right-addon">
                                <lookup-standalone class="searchbar"
                                                   ng-model="$ctrl.sousChapSelected"
                                                   text="$ctrl.sousChapSelected.CodeLibelle"
                                                   search-placeholder="{{$ctrl.resources.Global_ReferentielTache_Placeholder}}"
                                                   search-title="{{$ctrl.resources.Global_ReferentielSousChapitre}}"
                                                   on-select="$ctrl.handleLigneLookupSelection('SousChapitre', item, $ctrl.userGroup)"
                                                   show-in-popup="true"
                                                   show-delete-button="false"
                                                   url="/api/CompteExploitation/GetSousChapitres/{{$ctrl.userGroup}}">
                                </lookup-standalone>
                            </div>
                        </div>
                    </div>

                </div>
                @* BOUTONS CONTINUER / VALIDER*@
                <div class="modal-footer">
                    <button class="btn btn-link pull-left" ng-click="$ctrl.returnEdition1()" ng-show="$ctrl.btnReturn1Visible">{{$ctrl.resources.CE_Button_Retour}}</button>
                    <button class="btn btn-link pull-left" ng-click="$ctrl.returnEdition2()" ng-show="$ctrl.btnReturn2Visible">{{$ctrl.resources.CE_Button_Retour}}</button>
                    <button class="btn btn-link pull-left" data-dismiss="modal" ng-click="$ctrl.cancelEdition()" ng-show="$ctrl.btnCancelVisible">{{$ctrl.resources.Global_Bouton_Annuler}}</button>
                    <button class="btn btn-default pull-right" ng-model="$ctrl.btnContinuerToSecondFilter" ng-show="$ctrl.btnContinuerToSecondFilterVisible"
                            ng-click="$ctrl.clickContinuerToSecondFilter()">
                        {{$ctrl.resources.CE_Button_Continuer}}
                    </button>
                    <button class="btn btn-default pull-right" ng-model="$ctrl.btnContinuerToFormat" ng-show="$ctrl.btnContinuerToFormatVisible"
                            ng-click="$ctrl.clickContinuerToFormat()">
                        {{$ctrl.resources.CE_Button_Continuer}}
                    </button>

                    <button class="btn btn-default pull-right" ng-model="$ctrl.btnValider" ng-show="$ctrl.btnValiderVisible"
                            ng-click="$ctrl.clickLaunchExport()">
                        {{$ctrl.resources.Global_Bouton_Valider}}
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- END Modal pop  Dépenses in de rapprochement -->
    <!-- Modal pop Pointage in de rapprochement -->
    <div class="modal fade" id="ed-pointage-ex" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-show="$ctrl.popVisible.popPointage">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="flaticon flaticon-shuffle-1"></i>{{$ctrl.popupTitle}}</h2>
                    <i class="flaticon flaticon-multiply close pull-right" data-dismiss="modal" aria-label="Close"
                       title="Cliquer pour annuler et fermer" ng-click="$ctrl.cancelEditionPointing()"></i>
                </div>

                <div class="modal-body">
                    <div class="container-fluid">
                        @*Step for Task*@
                        <div class="bloc-stepper">
                            <div class="stepper-line">
                                <div id="step1" class="stepper-step" ng-class="{'selected' : $ctrl.step1PointingActiveted}">1</div>
                                <div id="step2" class="stepper-step" ng-class="{'selected' : $ctrl.step2PointingActiveted}">2</div>
                            </div>
                            <div class="stepper-bloc-text">
                                <div class="stepper-text">{{$ctrl.resources.CE_Popup_Step1_pointage}}</div>
                                <div class="stepper-text central">{{$ctrl.resources.CE_Popup_Step2__pointage}}</div>
                            </div>
                        </div>

                        @*Ajout CI *@
                        <div class="row" id="ajoutCis" ng-show="$ctrl.step1PointingActiveted ">

                            <div ng-class="$ctrl.isMaximumCiSelected()?'col-md-10':'col-md-12'">
                                <div class="col-md-1 tuile secondary" ng-repeat="ciselected in $ctrl.ciSelectedlist" title="Cliquer pour">
                                    <div class="row">
                                        <span class="pull-right" ng-click="$ctrl.removeCi($index)">×</span>
                                    </div>
                                    <div class="row">
                                        {{ciselected.CodeLibelle}}
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-2" ng-hide="!$ctrl.isMaximumCiSelected()">
                                <lookup ng-model="$ctrl.input"
                                        search-icon-class="material-icons"
                                        show-search-icon-only-when-empty="true"
                                        search-placeholder="{{$ctrl.resources.Global_ReferentielCI_Placeholder}}"
                                        search-title="{{$ctrl.resources.Global_ReferentielCI}}"
                                        on-select="$ctrl.addCi()"
                                        show-in-popup="true"
                                        url="/api/CI/SearchLight">
                                    <div class="tuile primary pull-right">
                                        <div class="row">Ajouter CI</div>
                                        <div class="row">
                                            <span class="pull-right add-ci">&#43</span>
                                        </div>
                                    </div>
                                </lookup>
                            </div>

                        </div>

                        @*Type pointage CI*@
                        <div class="row" id="TypeCi" ng-show="$ctrl.step2PointingActiveted">
                            <div class="col-md-2 col-md-offset-3">
                                <div class="detail-depenses-exploitation" ng-class="{'selected':$ctrl.pointingType.personnel}" ng-click="$ctrl.clickTypePointing($ctrl.resources.CE_PontagePersonnel)" ng-selected>
                                    <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_PontagePersonnel}}</span>
                                    <div class="inner-triangle" ng-show="$ctrl.pointingType.personnel"></div>
                                </div>
                            </div>
                            @* OU *@
                            <div class="col-md-1 ">
                                <span class="or">{{$ctrl.resources.CE_Popup_Ou}}</span>
                            </div>
                            <div class="col-md-2">
                                <div class="detail-depenses-exploitation" ng-class="{'selected':$ctrl.pointingType.materiel}" id="PointageMateriel" ng-click="$ctrl.clickTypePointing($ctrl.resources.CE_PontageMateriel)">
                                    <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_PontageMateriel}}</span>
                                    <div class="inner-triangle" ng-show="$ctrl.pointingType.materiel"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                @* BOUTONS CONTINUER / VALIDER*@
                <div class="modal-footer">
                    <div class="row">

                        @*Bouton Annuler*@

                        <button class="btn btn-link pull-left" data-dismiss="modal" ng-click="$ctrl.cancelEditionPointing()" ng-show="$ctrl.step1PointingActiveted">{{$ctrl.resources.Global_Bouton_Annuler}}</button>


                        @*Bouton Retour*@

                        <button class="btn btn-link pull-left" ng-show="$ctrl.step2PointingActiveted"
                                ng-click="$ctrl.clickReturnStep1Pointing()">
                            {{$ctrl.resources.CE_Button_Retour}}
                        </button>


                        @*Bouton cleay pour effaer tous les CI ajouter*@

                        @*<button class="btn btn-default pull-left" ng-click="$ctrl.clearCi()" ng-show="$ctrl.step1PointingActiveted">{{$ctrl.resources.CE_Button_Clear}}</button>*@


                        @*Bouton Valider*@

                        <button class="btn btn-default pull-right" ng-click="$ctrl.clickValideVerifPointing()" ng-show="$ctrl.step2PointingActiveted">
                            {{$ctrl.resources.Global_Bouton_Valider}}
                        </button>


                        @*Bouton Continuer*@

                        <button class="btn btn-default pull-right" ng-show="$ctrl.btnPointingContinueActiveted && $ctrl.step1PointingActiveted"
                                ng-click="$ctrl.clickContinueStep1Pointing()">
                            {{$ctrl.resources.CE_Button_Continuer}}
                        </button>

                    </div>
                </div>

            </div>
        </div>
    </div>
    <!-- END Modal pop  Poinage  in de rapprochement -->
    <!-- Modal pop Bilan Technique -->
    <div class="modal fade" id="ed-bil-tech" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-show="$ctrl.popVisible.popBilan">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="flaticon flaticon-shuffle-1"></i>{{$ctrl.popupTitle}}</h2>
                    <i class="flaticon flaticon-multiply close pull-right" data-dismiss="modal" aria-label="Close"
                       title="Cliquer pour annuler et fermer" ng-click="$ctrl.cancelEdition()"></i>
                </div>
                <div class="modal-body">
                    <div class="bloc-stepper">
                        <div class="stepper-line">
                            <div id="stepBilan1" class="stepper-step selected">1</div>
                            <div id="stepBilan2" class="stepper-step">2</div>
                        </div>
                        <div class="stepper-bloc-text">
                            <div class="stepper-text">{{$ctrl.resources.CE_Popup_Step1}}</div>
                            <div class="stepper-text central">{{$ctrl.resources.CE_Popup_Step3}}</div>
                        </div>
                    </div>

                    @* FIRST LEVEL FILTER *@
                    <div class="bloc-ed-dep-tiles">
                        <div class="detail-depenses-exploitation" id="firstLevelFilterChapitreBilan"
                             ng-click="$ctrl.firstLevelFilterClick($event, 'ChapitreBilan')">
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre_Chap_Bilan}}</span>
                            <div class="inner-triangle" ng-show="$ctrl.firstLevelFilterTriangle"></div>
                            <div class="triangle-down-arrow" ng-show="$ctrl.firstLevelFilterTriangle"> </div>
                        </div>
                        @* OU *@
                        <span class="or" ng-show="$ctrl.firstLevelFilter">{{$ctrl.resources.CE_Popup_Ou}}</span>
                        <div class="detail-depenses-exploitation" id="firstLevelFilterSousChapitreBilan"
                             ng-click="$ctrl.firstLevelFilterClick($event, 'SousChapitreBilan')">
                            <div class="inner-triangle" ng-show="$ctrl.firstLevelFilterTriangle"></div>
                            <div class="triangle-down-arrow" ng-show="$ctrl.firstLevelFilterTriangle">           </div>
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre_SousChap_Bilan}}</span>
                        </div>
                        @* OU *@
                        <span class="or" ng-show="$ctrl.firstLevelFilter">{{$ctrl.resources.CE_Popup_Ou}}</span>
                        <div class="detail-depenses-exploitation" id="firstLevelFiltersRessoureBilan"
                             ng-click="$ctrl.firstLevelFilterClick($event, 'RessourceBilan')">
                            <div class="inner-triangle" ng-show="$ctrl.firstLevelFilterTriangle"></div>
                            <div class="triangle-down-arrow" ng-show="$ctrl.firstLevelFilterTriangle">           </div>
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_Popup_Filtre_Ress_Bilan}}</span>
                        </div>
                        @* ------------------- *@
                        @*BOUTONS FORMATS PDF / EXCEL*@
                        @* ------------------- *@
                        <div class="detail-depenses-exploitation" id="formatExportPDFBilan"
                             ng-show="$ctrl.FormatVisible" ng-click="$ctrl.formatClick($event, 'PDF')">
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_FormatPDF}}</span>
                            <div class="inner-triangle"></div>
                            <span class="detail-depenses-icon pdf"></span>
                        </div>
                        <div class="detail-depenses-exploitation" id="formatExportExcelBilan"
                             ng-show="$ctrl.FormatVisible" ng-click="$ctrl.formatClick($event, 'Excel')">
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_FormatExcel}}</span>
                            <div class="inner-triangle"></div>
                            <span class="detail-depenses-icon excel"></span>
                        </div>

                    </div>

                    @*CHAPITRE / Veuillez sélectionner une valeur de filtre*@
                    <div class="modal-toolbar" id="firstLevelPartialStateFilterChapitreBilan">

                        <div class="modal-toolbar-bloc">
                            <fred-section-title>{{$ctrl.resources.CE_Popup_FiltreSelect}}</fred-section-title>
                            <div class="inner-addon right-addon">
                                <lookup-standalone class="searchbar"
                                                   ng-model="$ctrl.chapSelected"
                                                   text="$ctrl.chapSelected.CodeLibelle"
                                                   search-placeholder="{{$ctrl.resources.CE_ReferentielChapitre_Placeholder}}"
                                                   search-title="{{$ctrl.resources.Global_ReferentielChapitre}}"
                                                   on-select="$ctrl.handleLigneLookupSelection('ChapitreBilan', item, $ctrl.userGroup)"
                                                   show-in-popup="true"
                                                   show-delete-button="false"
                                                   url="/api/CompteExploitation/GetChapitres/{{$ctrl.userGroup}}">
                                </lookup-standalone>
                            </div>

                        </div>
                    </div>

                    @*SOUSCHAPITRE / Veuillez sélectionner une valeur de filtre*@
                    <div class="modal-toolbar" id="firstLevelPartialStateFilterSousChapitreBilan">

                        <div class="modal-toolbar-bloc">
                            <fred-section-title>{{$ctrl.resources.CE_Popup_FiltreSelect}}</fred-section-title>
                            <div class="inner-addon right-addon">
                                <lookup-standalone class="searchbar"
                                                   ng-model="$ctrl.sousChapSelected"
                                                   text="$ctrl.sousChapSelected.CodeLibelle"
                                                   search-placeholder="{{$ctrl.resources.CE_ReferentielSousChapitre_Placeholder}}"
                                                   search-title="{{$ctrl.resources.Global_ReferentielSousChapitre}}"
                                                   on-select="$ctrl.handleLigneLookupSelection('SousChapitreBilan', item, $ctrl.userGroup)"
                                                   show-in-popup="true"
                                                   show-delete-button="false"
                                                   url="/api/CompteExploitation/GetSousChapitres/{{$ctrl.userGroup}}">
                                </lookup-standalone>
                            </div>
                        </div>
                    </div>

                    @*RESSOURCE / Veuillez sélectionner une valeur de filtre*@
                    <div class="modal-toolbar" id="firstLevelPartialStateFilterRessourceBilan">

                        <div class="modal-toolbar-bloc">
                            <fred-section-title>{{$ctrl.resources.CE_Popup_FiltreSelect}}</fred-section-title>
                            <div class="inner-addon right-addon">
                                <lookup-standalone class="searchbar"
                                                   ng-model="$ctrl.ressourceSelected"
                                                   text="$ctrl.ressourceSelected.CodeLibelle"
                                                   search-placeholder="{{$ctrl.resources.Global_ReferentielRessource_Placeholder}}"
                                                   search-title="{{$ctrl.resources.Global_ReferentielRessource}}"
                                                   on-select="$ctrl.handleLigneLookupSelection('RessourceBilan', item, $ctrl.userGroup)"
                                                   show-in-popup="true"
                                                   show-delete-button="false"
                                                   on-click="$ctrl.showLookUpResource()">
                                </lookup-standalone>
                            </div>
                        </div>
                    </div>
                </div>
                @* BOUTONS CONTINUER / VALIDER*@
                <div class="modal-footer">
                    <button class="btn btn-link pull-left" ng-click="$ctrl.returnEdition1()" ng-show="$ctrl.btnReturn1Visible">{{$ctrl.resources.CE_Button_Retour}}</button>
                    <button class="btn btn-link pull-left" data-dismiss="modal" ng-click="$ctrl.cancelEdition()" ng-show="$ctrl.btnCancelVisible">{{$ctrl.resources.Global_Bouton_Annuler}}</button>
                    <button class="btn btn-default pull-right" ng-model="$ctrl.btnContinuerToFormat" ng-show="$ctrl.btnContinuerToFormatVisible===true"
                            ng-click="$ctrl.clickContinuerToFormat()">
                        {{$ctrl.resources.CE_Button_Continuer}}
                    </button>
                    <button class="btn btn-default pull-right" ng-model="$ctrl.btnValider" ng-show="$ctrl.btnValiderVisible"
                            ng-click="$ctrl.onExportBilanTechnique()">
                        {{$ctrl.resources.Global_Bouton_Valider}}
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- END Modal pop Bilan Technique -->
    <!-- Modal Tableau de synthese -->
    <div class="modal fade" id="ed-synthese" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-show="$ctrl.popVisible.popTabSynthese">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="flaticon flaticon-shuffle-1"></i>{{$ctrl.popupTitle}}</h2>
                    <i class="flaticon flaticon-multiply close pull-right" data-dismiss="modal" aria-label="Close"
                       title="Cliquer pour annuler et fermer" ng-click="$ctrl.cancelEdition()"></i>
                </div>
                <div class="modal-body">
                    <div class="bloc-stepper">
                        <div class="stepper-line">
                            <div id="stepper1" class="stepper-step" ng-class="{'selected': $ctrl.tabSyntheseStep===0}">1</div>
                            <div id="stepper2" class="stepper-step" ng-class="{'selected': $ctrl.tabSyntheseStep===1}">2</div>
                        </div>
                        <div class="stepper-bloc-text">
                            <div class="stepper-text">Choisir les axes</div>
                            <div class="stepper-text central">Choisir le format et valider</div>
                        </div>
                    </div>

                    <div ng-show="$ctrl.tabSyntheseStep===0">
                        <div class="bloc-axes-res-tasks">
                            <div class="axes-res-tasks-btns">
                                <button class="tasks-res" ng-class="{'selected': $ctrl.tabSyntheseAxeDirection === 'TacheRessource'}" ng-model="$ctrl.buttonTacheRessource"
                                        ng-click="$ctrl.setAxeDirection('TacheRessource')">
                                    {{$ctrl.resources.CE_Popup_Button_TacheRessource}}
                                </button>
                                <button class="tasks-res" ng-class="{'selected': $ctrl.tabSyntheseAxeDirection === 'RessourceTache'}" ng-model="$ctrl.buttonRessourceTache"
                                        ng-click="$ctrl.setAxeDirection('RessourceTache')">
                                    {{$ctrl.resources.CE_Popup_Button_RessourceTache}}
                                </button>
                            </div>
                            <div class="axes-res-tasks-txt">{{$ctrl.resources.CE_Popup_PleaseSelectAxis}}</div>
                        </div>
                        <div class="bloc-ed-dep-tiles">
                            <div style="display:flex;justify-content: center" class="col-md-12 no-padding">
                                <div class="detail-depenses-exploitation" ng-class="{'disabled': $ctrl.tabSyntheseAxeDisabled(axe), 'selected': axe.selected}"
                                     ng-repeat="axe in $ctrl.tabSyntheseAxeList | orderBy : 'order'"
                                     ng-click="$ctrl.tabSyntheseAxeClick(axe)">
                                    <span class="detail-depenses-exploitation-txt">{{axe.label}}</span>
                                    <div class="tab-synthese-inner-triangle" ng-show="axe.selected"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bloc-ed-dep-tiles" ng-show="$ctrl.tabSyntheseStep===1">
                        <div class="detail-depenses-exploitation" ng-class="{'selected': $ctrl.tabSyntheseFormat === 'PDF'}"
                             ng-click="$ctrl.tabSyntheseFormat = 'PDF'">
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_FormatPDF}}</span>
                            <div class="tab-synthese-inner-triangle" ng-show="$ctrl.tabSyntheseFormat === 'PDF'"></div>
                            <span class="detail-depenses-icon pdf"></span>
                        </div>
                        <div class="detail-depenses-exploitation" ng-class="{'selected': $ctrl.tabSyntheseFormat === 'Excel'}"
                             ng-click="$ctrl.tabSyntheseFormat = 'Excel'">
                            <span class="detail-depenses-exploitation-txt">{{$ctrl.resources.CE_FormatExcel}}</span>
                            <div class="tab-synthese-inner-triangle" ng-show="$ctrl.tabSyntheseFormat === 'Excel'"></div>
                            <span class="detail-depenses-icon excel"></span>
                        </div>
                    </div>
                </div>
                @* BOUTONS CONTINUER / VALIDER*@
                <div class="modal-footer">
                    <button class="btn btn-link pull-left" data-dismiss="modal" ng-click="$ctrl.cancelEdition()" ng-show="$ctrl.tabSyntheseStep===0">
                        {{$ctrl.resources.Global_Bouton_Annuler}}
                    </button>
                    <button class="btn btn-link pull-left" ng-show="$ctrl.tabSyntheseStep===1" ng-click="$ctrl.tabSyntheseStep=0">
                        {{$ctrl.resources.CE_Button_Retour}}
                    </button>
                    <button class="btn btn-default pull-right" ng-show="$ctrl.tabSyntheseStep===0 && $ctrl.tabSyntheseAxeSelected()" ng-click="$ctrl.tabSyntheseStep=1">
                        {{$ctrl.resources.CE_Button_Continuer}}
                    </button>
                    <button class="btn btn-default pull-right" ng-show="$ctrl.tabSyntheseStep===1 && $ctrl.tabSyntheseFormat" ng-click="$ctrl.clickExportTabSynthese()">
                        {{$ctrl.resources.Global_Bouton_Valider}}
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- END Modal pop  Dépenses in de rapprochement -->


</div>



