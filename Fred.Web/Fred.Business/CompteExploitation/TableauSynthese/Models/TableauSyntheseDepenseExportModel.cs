using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;

namespace Fred.Business.CompteExploitation.TableauSynthese.Models
{
    /// <summary>
    /// Model d'export des dépenses pour le tableau de synthèse
    /// </summary>
    [DebuggerDisplay("Key={Key} AxeGroup={AxeGroup} Libelle={Libelle} ")]
    public class TableauSyntheseDepenseExportModel
    {
        public string Key { get; set; }
        /// <summary>
        /// Axe de regroupement
        /// </summary>
        public string AxeGroup { get; set; }

        /// <summary>
        /// Libellé du regroupement
        /// </summary>
        public string Libelle { get; set; }

        /// <summary>
        /// Montant du budget
        /// </summary>
        public decimal MontantBudget { get; set; }

        public string MontantBudgetText { get; set; }

        /// <summary>
        /// Pourcentage d'avancement du mois
        /// </summary>
        public decimal MoisPourcentAvancement { get; set; }

        public string MoisPourcentAvancementText { get; set; }


        /// <summary>
        /// Montant d'avancement du mois
        /// </summary>
        public decimal MoisMontantAvancement { get; set; }

        public string MoisMontantAvancementText { get; set; }


        /// <summary>
        /// Montant d'avancement du mois précédent
        /// </summary>
        public decimal MoisMontantAvancementPrevious { get; set; }

        /// <summary>
        /// Montant comptabilisé du mois
        /// </summary>
        public decimal MoisMontantComptabilise { get; set; }

        public string MoisMontantComptabiliseText { get; set; }


        /// <summary>
        /// Montant comptabilisé du mois précédent
        /// </summary>
        public decimal MoisMontantComptabilisePrevious { get; set; }

        /// <summary>
        /// Montant correctif du mois
        /// </summary>
        public decimal MoisMontantCorrectif { get; set; }

        public string MoisMontantCorrectifText { get; set; }

        /// <summary>
        /// Montant correctif du mois précédent
        /// </summary>
        public decimal MoisMontantCorrectifPrevious { get; set; }

        /// <summary>
        /// Montant total du mois
        /// </summary>
        public decimal MoisMontantTotal { get; set; }

        public string MoisMontantTotalText { get; set; }

        /// <summary>
        /// Montant total du mois précédent
        /// </summary>
        public decimal MoisMontantTotalPrevious { get; set; }

        /// <summary>
        /// Ecart cumulé du mois
        /// </summary>
        public decimal MoisEcartCumul { get; set; }


        public string MoisEcartCumulText { get; set; }

        /// <summary>
        /// Ecart cumulé du mois précédent
        /// </summary>
        public decimal MoisEcartCumulPrevious { get; set; }

        /// <summary>
        /// Ecart du mois
        /// </summary>
        public decimal MoisEcart { get; set; }


        public string MoisEcartText { get; set; }

        /// <summary>
        /// Reste à dépenser fin d'affaire
        /// </summary>
        public decimal FinAffaireRad { get; set; }

        public string FinAffaireRadText { get; set; }

        /// <summary>
        /// Reste à dépenser fin d'affaire
        /// </summary>
        public decimal FinAffaireRadPrevious { get; set; }

        /// <summary>
        /// Ajustement fin d'affaire
        /// </summary>
        public decimal FinAffaireAjustementRad { get; set; }

        public string FinAffaireAjustementRadText { get; set; }

        /// <summary>
        /// Ajustement fin d'affaire mois précédent
        /// </summary>
        public decimal FinAffaireAjustementRadPrevious { get; set; }

        /// <summary>
        /// Montant actualisé fin d'affaire
        /// </summary>
        public decimal FinAffaireMontantActualise { get; set; }

        public string FinAffaireMontantActualiseText { get; set; }


        /// <summary>
        /// Montant actualisé fin d'affaire
        /// </summary>
        public decimal FinAffaireMontantActualisePrevious { get; set; }

        /// <summary>
        /// Ecart cumulé fin d'affaire
        /// </summary>
        public decimal FinAffaireEcartCumul { get; set; }

        public string FinAffaireEcartCumulText { get; set; }


        /// <summary>
        /// Ecart cumulé fin d'affaire mois précédent
        /// </summary>
        public decimal FinAffaireEcartCumulPrevious { get; set; }

        /// <summary>
        /// Ecart Mois fin d'affaire
        /// </summary>
        public decimal FinAffaireEcartMois { get; set; }

        public string FinAffaireEcartMoisText { get; set; }


        public TableauSyntheseDepenseExportModel Parent { get; set; }

        public List<TableauSyntheseDepenseExportModel> GetParents()
        {
            var parent = this.Parent;
            List<TableauSyntheseDepenseExportModel> list = new List<TableauSyntheseDepenseExportModel>();
            if (parent != null)
            {
                list.Add(parent);
                list.AddRange(parent.GetParents());
            }
            return list;
        }

        public string GetIdentifier()
        {
            var parents = GetParents();

            parents.Reverse();

            var parentKeys = parents.Select(x => x.Key).ToList();

            var result = string.Join(" ", parentKeys) + " " + this.Key;

            return result.Trim();
        }

    }
}
